<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>{% block title %}Welcome!{% endblock %}</title>
    {% block stylesheets %}{% endblock %}
    {% block styles %}
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    {% endblock %}
    {% include 'partials/styles.html.twig' %}
</head>
<body style="background: #2c343b">
<div class="container-fluid">
    {% block navbar %}
        <div class="row mb-5" style="background: rgba(255,255,255,0.8)">
            <div class="col-2 d-flex align-items-center">
                <div>
                    <h1>Projekt</h1>
                </div>
            </div>
            {% block navs %}
                <div class="col-10 d-flex justify-content-end">
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link {% if link == 'home' %} active {% endif %}" id="home-tab" data-toggle="tab" href="#home" role="tab"
                               aria-controls="home" aria-selected="true">Strona główna</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if link == 'quiz' %} active {% endif %}" id="quiz-tab" data-toggle="tab" href="#quiz" role="tab"
                               aria-controls="quiz" aria-selected="false">Quizy</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if link == 'ranking' %} active {% endif %}" id="ranking-tab" data-toggle="tab" href="#ranking" role="tab"
                               aria-controls="ranking" aria-selected="false">Rankingi</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if link == 'news' %} active {% endif %}" id="news-tab" data-toggle="tab" href="#news" role="tab"
                               aria-controls="news" aria-selected="false">Artykuły</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if link == 'logout' %} active {% endif %}" id="logout-tab" data-toggle="tab" href="#logout" role="tab"
                               aria-controls="logout" aria-selected="false">Wyloguj się</a>
                        </li>
                    </ul>
                </div>
            {% endblock %}
        </div>
    {% endblock navbar %}
    {% block content %}
        <div class="row">
            <div class="col-12">
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade {% if link == 'home' %}show active {% endif %}" id="home" role="tabpanel" aria-labelledby="home-tab">
                        {% include '@App/homepage.html.twig' %}
                    </div>
                    <div class="tab-pane fade {% if link == 'quiz' %}show active {% endif %}" id="quiz" role="tabpanel" aria-labelledby="quiz-tab">
                        {% include '@App/quizzes.html.twig' %}
                    </div>
                    <div class="tab-pane fade {% if link == 'ranking' %}show active {% endif %}" id="ranking" role="tabpanel" aria-labelledby="ranking-tab">
                        {% include '@App/ranking.html.twig' %}
                    </div>
                    <div class="tab-pane fade {% if link == 'news' %}show active {% endif %}" id="news" role="tabpanel" aria-labelledby="news-tab">
                        {{ render(controller('AppBundle:News:index')) }}
                    </div>
                    <div class="tab-pane fade {% if link == 'contact' %}show active {% endif %}" id="logout" role="tabpanel" aria-labelledby="contact-tab">
                        {% include '@App/logout.html.twig' %}
                    </div>
                </div>
            </div>
        </div>
    {% endblock content %}
</div>
{% block scripts %}
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" ></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" ></script>

    <script>
        jQuery(document).ready(function ($) {
            var slidesWrapper = $('.cd-hero-slider');

            //check if a .cd-hero-slider exists in the DOM
            if (slidesWrapper.length > 0) {
                var primaryNav = $('.cd-primary-nav'),
                    sliderNav = $('.cd-slider-nav'),
                    navigationMarker = $('.cd-marker'),
                    slidesNumber = slidesWrapper.children('li').length,
                    visibleSlidePosition = 0,
                    autoPlayId,
                    autoPlayDelay = 5000;

                //upload videos (if not on mobile devices)
                uploadVideo(slidesWrapper);

                //autoplay slider
                setAutoplay(slidesWrapper, slidesNumber, autoPlayDelay);

                //on mobile - open/close primary navigation clicking/tapping the menu icon
                primaryNav.on('click', function (event) {
                    if ($(event.target).is('.cd-primary-nav')) $(this).children('ul').toggleClass('is-visible');
                });

                //change visible slide
                sliderNav.on('click', 'li', function (event) {
                    event.preventDefault();
                    var selectedItem = $(this);
                    if (!selectedItem.hasClass('selected')) {
                        // if it's not already selected
                        var selectedPosition = selectedItem.index(),
                            activePosition = slidesWrapper.find('li.selected').index();

                        if (activePosition < selectedPosition) {
                            nextSlide(slidesWrapper.find('.selected'), slidesWrapper, sliderNav, selectedPosition);
                        } else {
                            prevSlide(slidesWrapper.find('.selected'), slidesWrapper, sliderNav, selectedPosition);
                        }

                        //this is used for the autoplay
                        visibleSlidePosition = selectedPosition;

                        updateSliderNavigation(sliderNav, selectedPosition);
                        updateNavigationMarker(navigationMarker, selectedPosition + 1);
                        //reset autoplay
                        setAutoplay(slidesWrapper, slidesNumber, autoPlayDelay);
                    }
                });
            }

            function nextSlide(visibleSlide, container, pagination, n) {
                visibleSlide.removeClass('selected from-left from-right').addClass('is-moving').one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function () {
                    visibleSlide.removeClass('is-moving');
                });

                container.children('li').eq(n).addClass('selected from-right').prevAll().addClass('move-left');
                checkVideo(visibleSlide, container, n);
            }

            function prevSlide(visibleSlide, container, pagination, n) {
                visibleSlide.removeClass('selected from-left from-right').addClass('is-moving').one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function () {
                    visibleSlide.removeClass('is-moving');
                });

                container.children('li').eq(n).addClass('selected from-left').removeClass('move-left').nextAll().removeClass('move-left');
                checkVideo(visibleSlide, container, n);
            }

            function updateSliderNavigation(pagination, n) {
                var navigationDot = pagination.find('.selected');
                navigationDot.removeClass('selected');
                pagination.find('li').eq(n).addClass('selected');
            }

            function setAutoplay(wrapper, length, delay) {
                if (wrapper.hasClass('autoplay')) {
                    clearInterval(autoPlayId);
                    autoPlayId = window.setInterval(function () {
                        autoplaySlider(length)
                    }, delay);
                }
            }

            function autoplaySlider(length) {
                if (visibleSlidePosition < length - 1) {
                    nextSlide(slidesWrapper.find('.selected'), slidesWrapper, sliderNav, visibleSlidePosition + 1);
                    visibleSlidePosition += 1;
                } else {
                    prevSlide(slidesWrapper.find('.selected'), slidesWrapper, sliderNav, 0);
                    visibleSlidePosition = 0;
                }
                updateNavigationMarker(navigationMarker, visibleSlidePosition + 1);
                updateSliderNavigation(sliderNav, visibleSlidePosition);
            }

            function uploadVideo(container) {
                var i = 0;
                container.find('.cd-bg-video-wrapper').each(function () {
                    var videoWrapper = $(this);
                    if (videoWrapper.is(':visible')) {
                        // if visible - we are not on a mobile device
                        var videoUrl = videoWrapper.data('video'),
                            video = $('<video loop><source src="' + videoUrl + '.mp4" type="video/mp4" /></video>');

                        if (i == 0) {
                            video = $('<video autoplay loop><source src="' + videoUrl + '.mp4" type="video/mp4" /></video>');
                        }

                        video.appendTo(videoWrapper);

                        // play video if first slide
                        if (videoWrapper.parent('.cd-bg-video.selected').length > 0) video.get(0).play();

                        i++;
                    }
                });
            }

            function checkVideo(hiddenSlide, container, n) {
                //check if a video outside the viewport is playing - if yes, pause it
                var hiddenVideo = hiddenSlide.find('video');
                if (hiddenVideo.length > 0) hiddenVideo.get(0).pause();

                //check if the select slide contains a video element - if yes, play the video
                var visibleVideo = container.children('li').eq(n).find('video');
                if (visibleVideo.length > 0) visibleVideo.get(0).play();
            }

            function updateNavigationMarker(marker, n) {
                marker.removeClassPrefix('item').addClass('item-' + n);
            }

            $.fn.removeClassPrefix = function (prefix) {
                //remove all classes starting with 'prefix'
                this.each(function (i, el) {
                    var classes = el.className.split(" ").filter(function (c) {
                        return c.lastIndexOf(prefix, 0) !== 0;
                    });
                    el.className = $.trim(classes.join(" "));
                });
                return this;
            };
        });
    </script>
{% endblock scripts %}
{% block javascripts %}{% endblock %}
</body>
</html>
